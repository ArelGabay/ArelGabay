name: 🤖 Local Fun Fact PR Bot

on:
  schedule:
    - cron: "*/15 * * * *"
  workflow_dispatch:
  pull_request:

permissions:
  contents: write
  pull-requests: write

jobs:
  update-fun-fact:
    name: pull_request  # 👈 ADD THIS LINE
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout repo
        uses: actions/checkout@v3

      - name: 🐍 Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: 🧠 Generate random local fun fact
        run: |
          import random
          import re

          facts = [
              "Bananas are berries, but strawberries aren't.",
              "Octopuses have three hearts.",
              "Honey never spoils — 3,000-year-old honey was still edible!",
              "Sharks are older than trees.",
              "The Eiffel Tower can grow over 6 inches in summer.",
              "A day on Venus is longer than its year.",
              "You can't hum while holding your nose closed.",
              "The fingerprints of a koala are almost identical to humans'."
          ]

          chosen = random.choice(facts)

          with open("README.md", "r") as file:
              content = file.read()

          new_content = re.sub(
              r'- ⚡ Fun fact: \*\*.*?\*\*',
              f'- ⚡ Fun fact: **{chosen}**',
              content
          )

          with open("README.md", "w") as file:
              file.write(new_content)
        shell: python

      - name: 🚀 Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "🔄 Update fun fact"
          branch: update-fun-fact
          title: "🔄 New Fun Fact"
          body: This PR updates the README with a new local fun fact!
          delete-branch: true

      - name: ✅ Enable auto-merge
        if: steps.cpr.outputs.pull-request-number != ''
        uses: peter-evans/enable-pull-request-automerge@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          pull-request-number: ${{ steps.cpr.outputs.pull-request-number }}
          merge-method: squash
